# 🏦 Dự Án Ngân Hàng Số – Core Banking MVP

## 🌟 Mục tiêu

Dựng hệ thống **Core Banking MVP** gồm:

- Đăng ký / đăng nhập người dùng
- Lưu trữ hồ sơ người dùng
- Giao dịch chuyển tiền
- Phát hiện rủi ro & gian lận theo thời gian thực
- Gắn kết Kafka, Cassandra, PostgreSQL, Docker, CI/CD

## 📦 Các thành phần đã triển khai

### 1. Auth Service (`auth-service`)

- Go HTTP server
- Endpoints: `/register`, `/login`, `/refresh-token`
- Sử dụng JWT
- ✅ Đã chạy ổn

---

### 2. User Profile Service (`user-profile-service`)

- CRUD hồ sơ người dùng
- Middleware xác thực JWT
- Kết nối PostgreSQL
- ✅ Đã chạy ổn định

---

### 3. Transaction Ledger (`transaction-ledger`)

- HTTP server Go với endpoint `/transaction`
- Tạo transaction ID và timestamp UTC
- Kafka producer gửi JSON đến topic `transactions`
- Kafka dùng thư viện `segmentio/kafka-go`
- Cassandra làm backend bất biến (đang tích hợp)
- ✅ Đã test thành công qua Postman (trả về `transaction_id`)

---

### 4. Risk Detection Service (`risk-detection`)

- Cấu trúc Go chuẩn: `cmd`, `internal`, `Makefile`

- API `/health`

- Kafka consumer từ topic `transactions`

- Module `EvaluateRisk()` gồm các rule:

  - > 5 giao dịch trong 1 giờ → `HIGH_RISK`
  - > 500 triệu VNĐ → `HIGH_RISK`
  - Ngược lại → `LOW_RISK`

- Ghi log chi tiết (user_id, amount, risk_level, timestamp)

- ✅ Đã chạy thành công và xử lý real-time

---

### 5. Kafka + Zookeeper

- Dùng Bitnami Docker images
- Đã chỉnh `ADVERTISED_LISTENERS=127.0.0.1:9092`
- Kafka broker kết nối OK với các service Go
- ✅ Ổn định

---

### 6. Docker Infrastructure

- Docker Compose quản lý PostgreSQL, Cassandra, Kafka, Zookeeper, Keycloak
- Tất cả chạy được bằng `docker compose up -d`
- ✅ Hạ tầng hoạt động tốt

---

### 7. Postman Test Suite

- Đã tạo collection test các API: `/register`, `/login`, `/transaction`
- ✅ Test thành công, nhận token, gửi giao dịch

---

## 🗂 Cấu trúc thư mục

```bash
│   docker-compose.yml
│   Makefile
│   README.md
│
├── auth-service
│   └── main.go
│
├── user-profile-service
│   └── main.go
│
├── transaction-ledger
│   ├── go.mod, go.sum, Makefile
│   ├── cmd/server/main.go
│   └── internal
│       ├── handler/transaction.go
│       └── kafka/producer.go
│
└── risk-detection
    ├── go.mod, go.sum, Makefile
    ├── cmd/server/main.go
    └── internal
        ├── app/risk_engine.go
        ├── handler/http.go
        ├── kafka/consumer.go
        └── risk/risk.go
```

---

## 🔄 Tiến trình tổng quát (đã hoàn thành)

| Bước                                | Trạng thái |
| ----------------------------------- | ---------- |
| Thiết kế kiến trúc dịch vụ          | ✅ Done    |
| Setup Docker Infra                  | ✅ Done    |
| Tạo 3 service Go cơ bản             | ✅ Done    |
| Test API qua Postman                | ✅ Done    |
| Tạo `risk-detection` chuẩn          | ✅ Done    |
| Gắn Kafka consumer cho risk service | ✅ Done    |
| Fix lỗi `connect`, `no host` Kafka  | ✅ Done    |
| Kafka ổn định, sẵn sàng hoạt động   | ✅ Done    |

---

## ⚡️ Giai đoạn tiếp theo (đang triển khai)

| Bước                                      | Trạng thái  | Ghi chú                         |
| ----------------------------------------- | ----------- | ------------------------------- |
| Gắn Kafka Producer cho transaction-ledger | 🟡 Đang làm | Gửi giao dịch qua Kafka         |
| Gửi giao dịch đến topic `transactions`    | 🟡 Đang làm | risk-detection sẽ tiếp nhận     |
| Ghi log/phản hồi HIGH_RISK từ risk-engine | 🟡 Chưa     | Đã có logic, cần output rõ ràng |
| (Tùy chọn) Gửi alert hoặc lưu risk        | 🖒 Kế tiếp   | Mở rộng logic nếu cần           |

---

## 🔭 Lộ trình tiếp theo

1. ✫️ Hoàn thiện Kafka producer trong `transaction-ledger`
2. 🚀 Gửi giao dịch mẫu từ API `/transaction`
3. ✅ Thấy log cảnh báo từ `risk-detection`
4. 🧩 Gắn loyalty / cashback (Grok + Claude)
5. ⚙️ Hoàn thiện CI / Makefile / Test automation
